(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48],{1379:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenants/create",function(){return r(771)}])},4153:function(e,t,r){"use strict";var n=r(5893),i=r(2963),s=r(5861),a=r(3795);t.Z=function(e){var t=e.crumbs,r=void 0===t?[]:t;return(0,n.jsx)(i.Z,{"aria-label":"breadcrumb",children:r.map((function(e,t){var r=e.title,i=e.onClick;return i?(0,n.jsx)(a.Z,{underline:"hover",className:"pointer",color:"inherit",onClick:i,children:r},"crumb_".concat(t)):(0,n.jsx)(s.Z,{color:"text.primary",children:r},"crumb_".concat(t))}))})}},919:function(e,t,r){"use strict";r.d(t,{G:function(){return x}});var n=r(5893),i=r(9657),s=r(8100),a=r(344),o=r(7547),l=r(4795),c=r(1178),d=r(1526),u=r(9473),h=r(4260),x=function(e){return(0,n.jsx)(s.tw,{domain:"dev-70rtqpgh.us.auth0.com",clientId:"iWG1AMTxDieKx9GTFaEJbHz9R6bWEZHV",redirectUri:"https://dev.meraklis.io",audience:"https://happy-tenant.meraklis.io/api",scope:"read:current_user update:current_user_metadata",children:(0,n.jsx)(u.zt,{store:d.Z,children:(0,n.jsx)(i.Z,{subtitle:"Management Portal",menuItems:[{name:"Properties",icon:(0,n.jsx)(l.Z,{}),route:c.ys},{name:"Tenants",icon:(0,n.jsx)(o.Z,{}),route:c.Ke}],loginRedirect:"/login",profilePath:"/profile",children:(0,n.jsxs)(a.Z,{children:[e,(0,n.jsx)(h.Z,{})]})})})})}},771:function(e,t,r){"use strict";r.r(t);var n=r(4051),i=r.n(n),s=r(5893),a=r(7294),o=r(4153),l=r(5861),c=r(1812),d=r(3321),u=r(3795),h=r(7357),x=r(135),m=r(6886),p=r(3841),j=r(8360),f=r(8972),Z=r(4054),v=r(6815),g=r(6901),b=r(9368),y=r(3457),P=r(480),D=r(7720),S=r(5916),I=r(2359),w=r(7463),k=r(7906),T=r(295),F=r(3252),N=r(2882),M=r(3184),_=r(3816),q=r(5113),C=r(6624),E=r(4472),A=r(3578),R=r(919),O=r(1163),z=r(7536),L=r(9669),B=r.n(L),W=r(381),G=r.n(W),$=r(8100),K=r(1178);function V(e,t,r,n,i,s,a){try{var o=e[s](a),l=o.value}catch(c){return void r(c)}o.done?t(l):Promise.resolve(l).then(n,i)}function Y(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){V(s,n,i,a,o,"next",e)}function o(e){V(s,n,i,a,o,"throw",e)}a(void 0)}))}}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){H(e,t,r[t])}))}return e}var J=function(){var e=(0,$.D3)().user,t=(0,O.useRouter)(),r=(0,a.useState)(),n=r[0],R=r[1],L=(0,a.useState)(!1),W=L[0],V=L[1],H=(0,a.useState)(null),J=H[0],Q=H[1],U=(0,a.useState)(null),ee=U[0],te=U[1],re=(0,a.useState)(0),ne=re[0],ie=re[1],se=["Tenant information","Invoice details","Review"],ae=(0,z.cI)({defaultValues:{propertyId:"",createMonthlySubscription:!1,addProratedFirstMonthsRent:!1,addLastMonthsRentToInvoice:!1,addSecurityDepositToInvoice:!1}}),oe=ae.register,le=ae.handleSubmit,ce=ae.getValues,de=ae.setValue,ue=ae.clearErrors,he=ae.trigger,xe=ae.watch,me=ae.control,pe=ae.formState.errors;oe("moveInDate",{required:"Move in date is required",valueAsDate:!0}),oe("billingStartDate",{required:"Billing start date is required",valueAsDate:!0});var je=xe("securityDeposit"),fe=xe("createMonthlySubscription"),Ze=xe("addProratedFirstMonthsRent"),ve=xe("addLastMonthsRentToInvoice"),ge=xe("addSecurityDepositToInvoice"),be=function(){var e=Y(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!0),e.next=3,B().post("/api/tenants",r).catch((function(){V(!1)}));case 3:t.push(K.Ke);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(e){var t;return null===(t=pe[e])||void 0===t?void 0:t.message},Pe=function(e){return void 0!==pe[e]};(0,a.useEffect)((function(){var t=function(){var t=Y(i().mark((function t(){var r,n,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B().get("/api/properties/search/findByCreatedBy",{params:{email:e.email}});case 2:r=t.sent,n=r.data,s=n._embedded.properties,R(s);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[e]);var De=(0,a.useMemo)((function(){if(!n)return[];var e=ce("propertyId");if(""===e)return[];var t=n.find((function(t){return t.id===e})),r=t.address,i=t.rent,s=[],a=0;if(ge){s.push({name:"".concat(r," - Security deposit"),calories:parseFloat(je).toFixed(2)});var o=parseFloat(je);isNaN(o)||(a+=o)}if(Ze){var l=G()(J),c=12*i/365*G()(ee).diff(l,"days");s.push({name:"".concat(r," - Prorated first month's rent"),calories:c.toFixed(2)}),a+=c}return ve&&(s.push({name:"".concat(r," - Last month's rent"),calories:parseFloat(i).toFixed(2)}),a+=i),{items:s,total:a=(Math.round(100*(a+Number.EPSILON))/100).toFixed(2)}}),[Ze,ve,ge,je,ee,ce,J,n]);if(!n)return(0,s.jsx)(s.Fragment,{});var Se=function(){var e=Y(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==ne){e.next=6;break}return e.next=3,he(["propertyId","fullName","email","moveInDate","billingStartDate","securityDeposit"]);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:ie((function(e){return e+1}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{crumbs:[{title:"Tenants",onClick:function(){return t.push(K.Ke)}},{title:"Create"}]}),0===n.length&&(0,s.jsxs)(g.Z,{severity:"warning",sx:{margin:"8px"},children:["Click ",(0,s.jsx)(u.Z,{className:"pointer",href:"/properties/create",children:"here"})," to add a property before inviting tenants."]}),(0,s.jsx)(h.Z,{m:2,children:(0,s.jsxs)("form",{onSubmit:le(be),children:[(0,s.jsx)(C.Z,{activeStep:ne,children:se.map((function(e){return(0,s.jsx)(E.Z,X({},{},{children:(0,s.jsx)(A.Z,X({},{},{children:e}))}),e)}))}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l.Z,{sx:{mt:2,mb:1},children:["Step ",ne+1]}),0===ne&&(0,s.jsxs)(m.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsxs)(Z.Z,{fullWidth:!0,required:!0,margin:"normal",size:"small",error:Pe("propertyId"),children:[(0,s.jsx)(p.Z,{htmlFor:"property-select",children:"Property"}),(0,s.jsx)(z.Qr,{control:me,name:"propertyId",render:function(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(j.Z,X({},oe("propertyId",{required:"Property is a required field."}),{id:"property-select",label:"Property",disabled:0===n.length,value:ce("propertyId"),children:n.map((function(e){return(0,s.jsx)(f.Z,{value:e.id,children:e.address},e.id)}))}))})}}),(0,s.jsx)(v.Z,{error:!0,children:ye("propertyId")})]})}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsx)(x.Z,X({},oe("fullName",{required:"Full name is a required field."}),{fullWidth:!0,required:!0,margin:"normal",size:"small",label:"Full Name",helperText:ye("fullName"),error:Pe("fullName")}))}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsx)(x.Z,X({},oe("email",{required:"Email is a required field."}),{fullWidth:!0,required:!0,margin:"normal",size:"small",label:"Email",helperText:ye("email"),error:Pe("email")}))}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsx)(I._,{dateAdapter:S.Z,children:(0,s.jsx)(w.$,{label:"Move in date",value:J,minDate:G()().add(1,"days"),renderInput:function(e){return(0,s.jsx)(x.Z,X({fullWidth:!0,required:!0,margin:"normal",size:"small"},e,{helperText:ye("moveInDate"),error:Pe("moveInDate")}))},onChange:function(e){e&&(Q(e.toDate()),de("moveInDate",e.toDate()))}})})}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsx)(I._,{dateAdapter:S.Z,children:(0,s.jsx)(w.$,{label:"Billing start date",value:ee,minDate:G()().add(1,"days"),renderInput:function(e){return(0,s.jsx)(x.Z,X({fullWidth:!0,required:!0,margin:"normal",size:"small"},e,{helperText:ye("billingStartDate"),error:Pe("billingStartDate")}))},onChange:function(e){e&&(te(e.toDate()),de("billingStartDate",e.toDate()))}})})}),(0,s.jsx)(m.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsx)(x.Z,X({},oe("securityDeposit",{required:"Security deposit is a required field",validate:function(e){return!(""===e||e<=0)}}),{inputProps:{inputMode:"numeric",pattern:"[0-9]*",step:"0.01"},fullWidth:!0,required:!0,type:"number",margin:"normal",size:"small",label:"Security Deposit ($)",helperText:ye("securityDeposit"),error:Pe("securityDeposit")}))})]}),1===ne&&(0,s.jsx)(m.ZP,{container:!0,spacing:2,children:(0,s.jsx)(m.ZP,{item:!0,sm:6,children:(0,s.jsxs)(y.Z,{children:[(0,s.jsx)(P.Z,{control:(0,s.jsx)(b.Z,X({checked:fe},oe("createMonthlySubscription"))),label:"Generate monthly invoices to collect rent"}),(0,s.jsx)(P.Z,{control:(0,s.jsx)(b.Z,X({checked:Ze},oe("addProratedFirstMonthsRent"))),label:"Add first month's prorated rent to initial invoice"}),(0,s.jsx)(P.Z,{control:(0,s.jsx)(b.Z,X({checked:ve},oe("addLastMonthsRentToInvoice"))),label:"Add last month's rent to initial invoice"}),(0,s.jsx)(P.Z,{control:(0,s.jsx)(b.Z,X({checked:ge},oe("addSecurityDepositToInvoice",{onChange:function(e){e.target.checked||ue("securityDeposit")}}))),label:"Add security deposit to initial invoice"})]})})}),2===ne&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(h.Z,{justifyContent:"center",width:650,margin:"0 auto",padding:2,children:[(0,s.jsx)(l.Z,{variant:"h6",children:"Tenant information"}),(0,s.jsxs)(m.ZP,{container:!0,spacing:1,padding:1,marginBottom:1,children:[(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Full name:"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("fullName")}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Email:"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("email")}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Move in date:"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:J.toLocaleDateString()}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Billing start date:"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ee.toLocaleDateString()})]}),(0,s.jsx)(D.Z,{}),(0,s.jsx)(l.Z,{variant:"h6",marginTop:1,children:"Invoice details"}),(0,s.jsxs)(m.ZP,{container:!0,spacing:1,padding:1,marginBottom:1,children:[(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Generate monthly invoices to collect rent?"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("createMonthlySubscription")?"Yes":"No"}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Add first months prorated rent to initial invoice?"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("addProratedFirstMonthsRent")?"Yes":"No"}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Add last months rent to initial invoice?"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("addLastMonthsRentToInvoice")?"Yes":"No"}),(0,s.jsx)(m.ZP,{item:!0,xs:8,children:(0,s.jsx)(l.Z,{variant:"subtitle2",children:"Add security deposit to initial invoice?"})}),(0,s.jsx)(m.ZP,{item:!0,xs:4,children:ce("addSecurityDepositToInvoice")?"Yes":"No"})]}),(0,s.jsx)(D.Z,{}),(0,s.jsx)(l.Z,{variant:"h6",marginTop:1,children:"Deposit"}),(ve||ge)&&(0,s.jsxs)(h.Z,{margin:2,children:[(0,s.jsx)(N.Z,{component:q.Z,children:(0,s.jsxs)(k.Z,{size:"small",children:[(0,s.jsx)(M.Z,{children:(0,s.jsxs)(_.Z,{children:[(0,s.jsx)(F.Z,{children:"Items"}),(0,s.jsx)(F.Z,{align:"right",children:"Amount ($)"})]})}),(0,s.jsx)(T.Z,{children:De.items.map((function(e){return(0,s.jsxs)(_.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,s.jsx)(F.Z,{component:"th",scope:"row",children:e.name}),(0,s.jsx)(F.Z,{align:"right",children:e.calories})]},e.name)}))})]})}),(0,s.jsx)(h.Z,{sx:{display:"flex",justifyContent:"flex-end",padding:"8px"},children:(0,s.jsxs)(l.Z,{variant:"h6",children:["Total: $",De.total]})}),(0,s.jsx)(l.Z,{variant:"caption",children:"**Note: First months rent will be billed separatly"})]})]})}),(0,s.jsxs)(h.Z,{sx:{display:"flex",flexDirection:"row",pt:2},children:[(0,s.jsx)(d.Z,{color:"inherit",disabled:0===ne,onClick:function(){ie((function(e){return e-1}))},sx:{mr:1},children:"Back"}),(0,s.jsx)(h.Z,{sx:{flex:"1 1 auto"}}),ne<se.length-1&&(0,s.jsx)(d.Z,{onClick:Se,disabled:0===n.length,children:"Next"}),ne===se.length-1&&(0,s.jsx)(c.Z,{variant:"contained",type:"submit",loading:W,children:"Finish"})]})]})]})})]})};J.getLayout=R.G,t.default=J}},function(e){e.O(0,[885,602,146,829,548,673,644,182,589,828,774,888,179],(function(){return t=1379,e(e.s=t);var t}));var t=e.O();_N_E=t}]);